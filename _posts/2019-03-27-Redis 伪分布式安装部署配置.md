---
layout: post
title:  "Redis 伪分布式安装部署配置"
categories: 分布式
tags:  分布式
author:W.Fly
---
* content
{:toc}

## 测试环境
redis需要安装在linux服务器上运行测试，本项目使用linux虚拟机及ssh客户端进行功能测试。

### 虚拟机
创建Centos6.5虚拟机作为linux服务器。

### ssh客户端
在开发环境(windows)安装ssh客户端，本项目使用Xshell作为ssh客户端连接虚拟机。

## 安装运行redis
### redis安装环境
- redis是C语言开发，建议在linux上运行，本项目使用Centos6.5作为安装环境。
- 安装redis需要先将官网下载的源码进行编译，编译依赖gcc环境，如果没有gcc环境，需要安装gcc：yum install gcc-c++

## redis安装
- 版本说明：本项目使用redis3.0版本。3.0版本主要增加了redis集群功能。
- 源码下载：官网下载地址http://download.redis.io/releases/redis-3.0.0.tar.gz，并将redis-3.0.0.tar.gz拷贝到/usr/local下
- 解压源码：tar -zxvf redis-3.0.0.tar.gz  
- 进入解压后的目录进行编译：
    - cd /usr/local/redis-3.0.0
	- make
- 安装到指定目录,如 /usr/local/redis：
    - cd /usr/local/redis-3.0.0
    - make PREFIX=/usr/local/redis install

- redis.conf：它是redis的配置文件
    - 注意修改port作为redis进程的端口，port默认6379
- 拷贝配置文件到安装目录下（进入源码目录，里面有一份配置文件redis.conf，然后将其拷贝到安装路径下）： 
    - cd /usr/local/redis
    - mkdir conf
    - cp /usr/local/redis-3.0.0/redis.conf /usr/local/redis/bin
- 安装目录bin下的文件列表

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/1.png)

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/2.png)

redis3.0新增的redis-sentinel是redis集群管理工具可实现高可用。

## redis启动
### 前端模式启动
直接运行bin/redis-server将以前端模式启动，前端模式启动的缺点是ssh命令窗口关闭则redis-server程序结束，不推荐使用此方法。如下图：

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/3.png)

### 后端模式启动
修改redis.conf配置文件，daemonize yes 以后端模式启动。
执行如下命令启动redis：

- cd /usr/local/redis
- ./bin/redis-server ./redis.conf

redis默认使用6379端口。

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/4.png)

也可更改redis.conf文件，修改端口号：

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/5.png)

### 启动多个redis进程
- 创建多个redis目录，以端口号命名，比如：创建6379、6380两个目录，将redis的安装文件bin和conf拷贝至这两个目录。
- 修改6379目录下的redis.conf设置端口号为6379
- 修改6380目录下的redis.conf设置端口号为6380
- 启动6379和6380目录下的redis-server程序：
    - cd 6379
    - ./redis-server . /redis.conf
    - cd 6380
    - ./redis-server . /redis.conf

查询当前redis的进程：

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/7.png)

### redis停止
强行终止Redis进程可能会导致redis持久化数据丢失。正确停止Redis的方式应该是向Redis发送SHUTDOWN命令，方法为：
- cd /usr/local/redis
- ./bin/redis-cli shutdown
