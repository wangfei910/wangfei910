---
layout: post
title:  "Redis 伪分布式安装部署配置"
categories: 分布式
tags:  分布式 Redis集群
author: W.Fly
---
* content
{:toc}
redis安装、启动、集群

## 测试环境
- redis需要安装在linux服务器上运行测试，本项目使用linux虚拟机及ssh客户端进行功能测试。
- 集群中应该至少有三个节点，每个节点有一备份节点。需要6台服务器。 
- 搭建伪分布式，需要6个redis实例（生产环境搭建只需改下IP地址即可，步骤相似）。
### 虚拟机
- 创建Centos6.5虚拟机作为linux服务器。
### ssh客户端
- 在开发环境(windows)安装ssh客户端，本项目使用Xshell作为ssh客户端连接虚拟机。
## 安装redis
### redis安装环境
- redis是C语言开发，建议在linux上运行，本项目使用Centos6.5作为安装环境。
- 安装redis需要先将官网下载的源码进行编译，编译依赖gcc环境，如果没有gcc环境，需要安装gcc：yum install gcc-c++
### redis安装
- 版本说明：本项目使用redis3.0版本。3.0版本主要增加了redis集群功能。
- 源码下载：[下载地址](http://pan.baidu.com/s/1kV2aZWz)，在/usr/local/目录下创建redis-cluster文件，解压redis到redis-cluster目录下，并复制6个redis实例指定端口从7001到7006
- 解压源码：tar -zxvf redis-3.0.0.tar.gz  
- redis.conf：它是redis的配置文件
    - 编辑redis.conf 文件,修改端口号以及打开Cluster-enable yes前面的注释：redis02、redis03…以此类推
```
[root@localhost redis-cluster]# vi redis01/redis.conf
```
![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/1.png)

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/2.png)

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/3.png)

- 需要一个ruby脚本。在redis源码文件夹下的src目录下。redis-trib.rb 
- 把redis-trib.rb文件复制到到redis-cluster目录下。 
- 执行ruby脚本之前，需要安装ruby环境。

```
[root@localhost ~]# yum install ruby

[root@localhost ~]# yum install rubygems
```
- 安装redis-trib.rb运行依赖的ruby的包。 [redis-3.0.0.gem下载链接](https://download.csdn.net/download/jack85986370/9491462)

```
[root@localhost ~]# gem install redis-3.0.0.gem
```
## redis启动
启动所有的redis实例，为方便启动写了个start-all.sh的脚本

![image](https://github.com/wangfei910/wangfei910.github.io/raw/master/_pic/Redis/4.png)

```
[root@localhost redis-cluster]# ./start-all.sh 
```
### 使用redis-trib.rb创建集群
```
[root@localhost ~]# ./redis-trib.rb create --replicas 1 192.168.25.153:7001 192.168.25.153:7002 192.168.25.153:7003 192.168.25.153:7004 192.168.25.153:7005  192.168.25.153:7006
```
### 使用客户端连接集群
```
[root@localhost redis-cluster]# redis01/redis-cli -p 7001 -c
```
## 其他启动方式
### 前端模式启动
直接运行bin/redis-server将以前端模式启动，前端模式启动的缺点是ssh命令窗口关闭则redis-server程序结束，不推荐使用此方法。
### 后端模式启动
修改redis.conf配置文件，daemonize yes 以后端模式启动。
执行如下命令启动redis：
```
[root@localhost ~]# cd /usr/local/redis
[root@localhost redis]# ./bin/redis-server ./redis.conf
```
### redis停止
强行终止Redis进程可能会导致redis持久化数据丢失。正确停止Redis的方式应该是向Redis发送SHUTDOWN命令，方法为：
```
[root@localhost ~]# cd /usr/local/redis
[root@localhost redis]# ./bin/redis-cli shutdown
```
